<!doctype html>
<html>
	<head>
		<meta name='viewport' content='width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0'>
		<script src="vendor/three.101.min.js"></script>	
		<script src="THREEAR.js"></script>
		<title>AR Kidneys Explorer - Kids Anatomy</title>
		<style>
			body { margin: 0px; overflow: hidden; font-family: 'Arial', sans-serif; background-color: #000; }
			.ar-ui { position: absolute; top: 20px; left: 20px; z-index: 100; background: rgba(255, 255, 255, 0.9); padding: 15px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); max-width: 300px; }
			.ar-title { color: #26de81; font-size: 1.4rem; font-weight: bold; margin: 0 0 10px 0; }
			.ar-instructions { color: #333; font-size: 0.9rem; margin: 0 0 15px 0; line-height: 1.4; }
			.ar-back-btn { background: #26de81; color: white; border: none; padding: 10px 20px; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 0.9rem; }
			.ar-back-btn:hover { background: #20c76b; }
			.kidney-info { position: absolute; bottom: 20px; left: 20px; right: 20px; background: rgba(38, 222, 129, 0.9); color: white; padding: 15px; border-radius: 15px; text-align: center; z-index: 100; }
			.kidney-fact { font-size: 1.1rem; font-weight: bold; margin: 0; }
		</style>
	</head>
	<body>
		<div class="ar-ui">
			<h1 class="ar-title">ü´ò AR Kidneys Explorer</h1>
			<p class="ar-instructions">Point your camera at the AR marker to see 3D kidneys! Watch them filter blood like tiny cleaning machines!</p>
			<button class="ar-back-btn" onclick="window.history.back()">‚Üê Back to Organs</button>
		</div>
		<div class="kidney-info">
			<p class="kidney-fact">ü´ò Your kidneys clean 50 gallons of blood every day!</p>
		</div>
		<script>
			var renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
			renderer.setClearColor(new THREE.Color('lightgrey'), 0);
			renderer.setSize(window.innerWidth, window.innerHeight);
			renderer.domElement.style.position = 'absolute';
			renderer.domElement.style.top = '0px';
			renderer.domElement.style.left = '0px';
			document.body.appendChild(renderer.domElement);
			
			var scene = new THREE.Scene();
			var camera = new THREE.Camera();
			scene.add(camera);
			var kidneyGroup = new THREE.Group();
			scene.add(kidneyGroup);
			var source = new THREEAR.Source({ renderer, camera });

			THREEAR.initialize({ source: source }).then((controller) => {
				// Create left kidney
				var leftKidneyGeometry = new THREE.SphereGeometry(0.15, 16, 16);
				leftKidneyGeometry.scale(1, 1.5, 0.8); // Make kidney-shaped
				var leftKidneyMaterial = new THREE.MeshPhongMaterial({ color: 0x26de81, transparent: true, opacity: 0.9 });
				var leftKidney = new THREE.Mesh(leftKidneyGeometry, leftKidneyMaterial);
				leftKidney.position.set(-0.2, 0.5, 0);
				kidneyGroup.add(leftKidney);

				// Create right kidney
				var rightKidneyGeometry = new THREE.SphereGeometry(0.15, 16, 16);
				rightKidneyGeometry.scale(1, 1.5, 0.8);
				var rightKidneyMaterial = new THREE.MeshPhongMaterial({ color: 0x26de81, transparent: true, opacity: 0.9 });
				var rightKidney = new THREE.Mesh(rightKidneyGeometry, rightKidneyMaterial);
				rightKidney.position.set(0.2, 0.5, 0);
				kidneyGroup.add(rightKidney);

				// Create filtering particles
				var filterParticles = [];
				for (let i = 0; i < 40; i++) {
					var particleGeometry = new THREE.SphereGeometry(0.008, 6, 6);
					var particleMaterial = new THREE.MeshBasicMaterial({ color: 0x4169e1, transparent: true, opacity: 0.8 });
					var particle = new THREE.Mesh(particleGeometry, particleMaterial);
					particle.position.set((Math.random() - 0.5) * 1.0, Math.random() * 1.2 + 0.2, (Math.random() - 0.5) * 1.0);
					particle.userData = { speed: Math.random() * 0.02 + 0.01 };
					filterParticles.push(particle);
					kidneyGroup.add(particle);
				}

				var ambientLight = new THREE.AmbientLight(0x404040, 0.6);
				scene.add(ambientLight);
				var directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
				directionalLight.position.set(1, 1, 1);
				scene.add(directionalLight);

				var patternMarker = new THREEAR.PatternMarker({ patternUrl: 'data/patt.hiro', markerObject: kidneyGroup });
				controller.trackMarker(patternMarker);

				var time = 0;
				requestAnimationFrame(function animate(nowMsec){
					requestAnimationFrame(animate);
					time += 0.016;
					
					// Filtering animation (gentle pulsing)
					var filterScale = 1 + Math.sin(time * 2) * 0.06;
					leftKidney.scale.set(filterScale, filterScale, filterScale);
					rightKidney.scale.set(filterScale, filterScale, filterScale);
					
					// Animate filtering particles
					filterParticles.forEach((particle, index) => {
						particle.position.y += Math.sin(time + index) * particle.userData.speed;
						if (particle.position.y > 1.5) particle.position.y = 0.2;
						particle.rotation.x += 0.02;
						particle.rotation.y += 0.02;
					});
					
					controller.update(source.domElement);
					renderer.render(scene, camera);
				});
			});
		</script>
	</body>
</html>
