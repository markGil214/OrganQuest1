<!doctype html>
<html>
	<head>
		<meta name='viewport' content='width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0'>
		<script src="vendor/three.101.min.js"></script>	
		<script src="THREEAR.js"></script>
		<title>AR Stomach Explorer - Kids Anatomy</title>
		<style>
			body { margin: 0px; overflow: hidden; font-family: 'Arial', sans-serif; background-color: #000; }
			.ar-ui { position: absolute; top: 20px; left: 20px; z-index: 100; background: rgba(255, 255, 255, 0.9); padding: 15px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); max-width: 300px; }
			.ar-title { color: #feca57; font-size: 1.4rem; font-weight: bold; margin: 0 0 10px 0; }
			.ar-instructions { color: #333; font-size: 0.9rem; margin: 0 0 15px 0; line-height: 1.4; }
			.ar-back-btn { background: #feca57; color: white; border: none; padding: 10px 20px; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 0.9rem; }
			.ar-back-btn:hover { background: #feb236; }
			.stomach-info { position: absolute; bottom: 20px; left: 20px; right: 20px; background: rgba(254, 202, 87, 0.9); color: white; padding: 15px; border-radius: 15px; text-align: center; z-index: 100; }
			.stomach-fact { font-size: 1.1rem; font-weight: bold; margin: 0; }
		</style>
	</head>
	<body>
		<div class="ar-ui">
			<h1 class="ar-title">üçΩÔ∏è AR Stomach Explorer</h1>
			<p class="ar-instructions">Point your camera at the AR marker to see a 3D stomach! Watch it digest food like a mixing machine!</p>
			<button class="ar-back-btn" onclick="window.history.back()">‚Üê Back to Organs</button>
		</div>
		<div class="stomach-info">
			<p class="stomach-fact">üçΩÔ∏è Your stomach can stretch to hold up to 4 liters of food!</p>
		</div>
		<script>
			var renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
			renderer.setClearColor(new THREE.Color('lightgrey'), 0);
			renderer.setSize(window.innerWidth, window.innerHeight);
			renderer.domElement.style.position = 'absolute';
			renderer.domElement.style.top = '0px';
			renderer.domElement.style.left = '0px';
			document.body.appendChild(renderer.domElement);
			
			var scene = new THREE.Scene();
			var camera = new THREE.Camera();
			scene.add(camera);
			var stomachGroup = new THREE.Group();
			scene.add(stomachGroup);
			var source = new THREEAR.Source({ renderer, camera });

			THREEAR.initialize({ source: source }).then((controller) => {
				// Create stomach (J-shaped)
				var stomachGeometry = new THREE.SphereGeometry(0.25, 16, 16);
				stomachGeometry.scale(1.2, 1.5, 0.8);
				var stomachMaterial = new THREE.MeshPhongMaterial({ color: 0xfeca57, transparent: true, opacity: 0.8 });
				var stomach = new THREE.Mesh(stomachGeometry, stomachMaterial);
				stomach.position.y = 0.5;
				stomach.rotation.z = 0.3; // Slight tilt for J-shape
				stomachGroup.add(stomach);

				// Create food particles being digested
				var foodParticles = [];
				var foodColors = [0xff6b6b, 0x4ecdc4, 0xff9f43, 0x26de81, 0x845ec2];
				for (let i = 0; i < 20; i++) {
					var particleGeometry = new THREE.SphereGeometry(0.015, 8, 8);
					var particleMaterial = new THREE.MeshBasicMaterial({ 
						color: foodColors[Math.floor(Math.random() * foodColors.length)], 
						transparent: true, 
						opacity: 0.9 
					});
					var particle = new THREE.Mesh(particleGeometry, particleMaterial);
					
					// Position particles inside stomach area
					var angle = Math.random() * Math.PI * 2;
					var radius = Math.random() * 0.2;
					particle.position.x = Math.cos(angle) * radius;
					particle.position.y = 0.5 + (Math.random() - 0.5) * 0.4;
					particle.position.z = Math.sin(angle) * radius;
					
					particle.userData = { 
						angle: angle,
						radius: radius,
						speed: Math.random() * 0.02 + 0.01 
					};
					foodParticles.push(particle);
					stomachGroup.add(particle);
				}

				// Create digestive acid particles
				var acidParticles = [];
				for (let i = 0; i < 15; i++) {
					var acidGeometry = new THREE.SphereGeometry(0.008, 6, 6);
					var acidMaterial = new THREE.MeshBasicMaterial({ color: 0x90ee90, transparent: true, opacity: 0.7 });
					var acid = new THREE.Mesh(acidGeometry, acidMaterial);
					acid.position.set((Math.random() - 0.5) * 0.5, 0.5 + (Math.random() - 0.5) * 0.4, (Math.random() - 0.5) * 0.5);
					acidParticles.push(acid);
					stomachGroup.add(acid);
				}

				var ambientLight = new THREE.AmbientLight(0x404040, 0.6);
				scene.add(ambientLight);
				var directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
				directionalLight.position.set(1, 1, 1);
				scene.add(directionalLight);

				var patternMarker = new THREEAR.PatternMarker({ patternUrl: 'data/patt.hiro', markerObject: stomachGroup });
				controller.trackMarker(patternMarker);

				var time = 0;
				requestAnimationFrame(function animate(nowMsec){
					requestAnimationFrame(animate);
					time += 0.016;
					
					// Stomach churning animation
					var churnScale = 1 + Math.sin(time * 1.5) * 0.1;
					stomach.scale.set(churnScale, 1, churnScale);
					stomach.rotation.y += 0.002;
					
					// Animate food particles (churning motion)
					foodParticles.forEach((particle, index) => {
						particle.userData.angle += particle.userData.speed;
						particle.position.x = Math.cos(particle.userData.angle) * particle.userData.radius;
						particle.position.z = Math.sin(particle.userData.angle) * particle.userData.radius;
						particle.rotation.x += 0.03;
						particle.rotation.y += 0.03;
					});
					
					// Animate acid particles
					acidParticles.forEach((particle, index) => {
						particle.position.y += Math.sin(time * 2 + index) * 0.003;
						particle.rotation.x += 0.04;
						particle.rotation.y += 0.04;
					});
					
					controller.update(source.domElement);
					renderer.render(scene, camera);
				});
			});
		</script>
	</body>
</html>
